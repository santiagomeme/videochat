<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interfaz del Monitor</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>

    <link rel="stylesheet" href="monitor.css">
    <link rel="stylesheet" href="chat.css">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

</head>
<body>
<div class="contenedor">
  <header class="encabezado">
    <h1>Bienvenido, Monitor</h1>
    <div id="estadoSesion" style="font-size: 14px; margin-top: 10px; color: #aaa;"></div>

    <div class="botones-header">
      <button class="btn-dorado" id="stopBroadcast">⏹ Detener transmisión</button>
      <button class="btn-dorado" onclick="window.location.href='index.html'">🏠 Volver</button>
    </div>
  </header>

  <main>
    <section id="monitorControls" class="formulario">
      <h2 class="titulo">MyVideoFree</h2>
      <button type="button" class="btn-dorado" id="startBroadcast">🎥 Iniciar transmisión</button>

      <p><span class="titulo">Monitor:</span> <span class="valor" id="monitorNombre">Desconocido</span></p>
      <p><span class="titulo">ID de sala:</span> <span class="valor" id="roomIdText">---</span></p>

      <p class="titulo">Link para observadores:</p>
      <input class="input-dorado" id="shareLink" type="text" readonly />
      <button class="btn-dorado" id="copiarEnlaceBtn">📋 Copiar enlace</button>
      <span id="copiarConfirmacion" class="valor" style="display:block; margin-top: 5px;"></span>
    </section>

    <section class="videoSection">
      <h2 class="titulo">Vista previa</h2>
      <video id="localVideo" autoplay muted playsinline></video>
    </section>

    <section class="botones">
      <button class="btn-dorado" id="capturarBtn">📸 Capturar Imagen</button>
    </section>
  </main>

  <canvas id="capturaCanvas" style="display:none;"></canvas>

 
<section class="chat-panel">
  <h3>Chat de la sala</h3>
  <div class="chat-scroll">
    <ul id="chatList" class="chat-list"></ul>
  </div>
  <form id="chatForm" class="chat-form" autocomplete="off">
    <input id="chatInput" type="text" placeholder="Escribe un mensaje..." maxlength="500" required />
    <button type="submit">Enviar</button>
  </form>
</section>


 <div class="panel-observadores">
  <h3>👁️ Observadores Conectados: <span id="totalObservadores">0</span></h3>
  <ul id="listaObservadores"></ul>
</div>

</div>





 <script defer src="firebase-config.js"></script> <!-- 👈 Este archivo contiene tu config e inicialización -->
    <script defer src="iceServers.js"></script>
    <script defer src="monitor.js"></script>
    
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // 1. Obtener parámetros de la URL
    const params = new URLSearchParams(window.location.search);
    const roomId = params.get("roomId");
    const monitor = params.get("monitor");

    // 2. Generar link
    const linkGenerado = `https://myvideofree.web.app/observadores.html?roomId=${roomId}&senderId=observador123`;

    // 3. Asignar a los elementos del DOM
    const roomIdText = document.getElementById("roomIdText");
    const shareInput = document.getElementById("shareLink");
    const monitorNombre = document.getElementById("monitorNombre");
    const copiarBtn = document.getElementById("copiarEnlaceBtn");
    const confirmacion = document.getElementById("copiarConfirmacion");

    if (roomIdText) roomIdText.textContent = roomId || "---";
    if (shareInput) shareInput.value = linkGenerado;
    if (monitorNombre) monitorNombre.textContent = monitor || "Desconocido";

    // 4. Lógica para copiar al portapapeles
    if (copiarBtn) {
      copiarBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(shareInput.value);
          confirmacion.textContent = "¡Enlace copiado!";
          confirmacion.style.color = "gold";
          setTimeout(() => (confirmacion.textContent = ""), 2000);
        } catch (err) {
          console.error("❌ Error al copiar:", err);
          confirmacion.textContent = "Error al copiar";
          confirmacion.style.color = "red";
        }
      });
    }
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {

//mostrar en pantalla el nombe de si mismo con el q se registro
firebase.auth().onAuthStateChanged(user => {
  const estadoSesion = document.getElementById("estadoSesion");
  if (user) {
    estadoSesion.textContent = `✅ Autenticado como: ${user.displayName || "Usuario"} (UID: ${user.uid})`;
    estadoSesion.style.color = "green";
  } else {
    estadoSesion.textContent = "❌ No autenticado. Es necesario iniciar sesión.";
    estadoSesion.style.color = "red";
  }
});
  });
</script>


 

</body>
</html>
