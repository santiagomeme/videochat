<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interfaz del Observador</title>
  <link rel="stylesheet" href="style.css" />


    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script> <!-- ⚠️ IMPORTANTE -->

    <link rel="stylesheet" href="style.css" />
  
</head>
<body>
  <h1>Bienvenido, Observador</h1>
  <h2>Conectado como Observador</h2>

  <div id="salaInfo">
    <p><strong>ID de sala:</strong> <span id="roomIdText"></span></p>
    <p><strong>Monitor:</strong> <span id="monitorName">Desconocido</span></p>
  </div>

  <div id="videos">
    <p><strong>Video del monitor:</strong></p>
    <video id="remoteVideo" autoplay playsinline controls></video>
  </div>

  <div id="captura">
    <p><strong>Captura de pantalla:</strong></p>
    <img id="screenshotImage" alt="Captura del monitor" />
  </div>


  <script src="firebase-config.js"></script> <!-- 👈 Este archivo contiene tu config e inicialización -->
    <script src="iceServers.js"></script>
    <script src="observador.js"></script> 
    <script src="observadorRTC.js"></script>




  <script>
    // Función para obtener parámetros de la URL
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    document.addEventListener("DOMContentLoaded", () => {
      const roomId = getQueryParam("roomId");
      const senderId = getQueryParam("senderId");

      if (!roomId || !senderId) {
        alert("❌ Faltan parámetros.");
        return;
      }

      // Mostrar ID de sala
      document.getElementById("roomIdText").textContent = roomId;

      // Conexión al WebSocket
      const socket = new WebSocket("wss://shrouded-star-apple.glitch.me");

      socket.onopen = () => {
        console.log("👁️ Observador conectado a WebSocket");
        socket.send(JSON.stringify({
          type: "joinRoom",
          roomId,
          senderId
        }));
      };

      socket.onmessage = (event) => {
        const msg = JSON.parse(event.data);
        console.log("📩 Mensaje recibido:", msg);

        // Mostrar nombre del monitor
        if (msg.type === "monitorInfo" && msg.roomId === roomId) {
          document.getElementById("monitorName").textContent = msg.monitorName || "Desconocido";
        }

        // Mostrar captura de pantalla
        if (msg.type === "monitorScreenshot" && msg.roomId === roomId) {
          const imgElement = document.getElementById("screenshotImage");
          imgElement.src = msg.imageData; // base64
        }

        // Mostrar video remoto (opcional, si usas WebRTC o streaming)
        if (msg.type === "monitorStream" && msg.roomId === roomId) {
          const videoElement = document.getElementById("remoteVideo");
          videoElement.srcObject = msg.stream; // Solo si envías stream real
        }
      };

      socket.onerror = (error) => {
        console.error("❌ Error en WebSocket:", error);
      };

      socket.onclose = () => {
        console.warn("🔌 Conexión WebSocket cerrada");
      };
    });
  </script>
  
</body>
</html>
